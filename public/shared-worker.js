var n=[],p,r;self.onconnect=t=>{let e=t.ports[0];n.push(e),e.onmessage=s=>{let{type:o,payload:a}=s.data;if(o==="connect"&&r!==a.accessToken&&(c(n,{type:"debug",payload:"Received SSE connect request with updated token"}),r&&p&&i(p,n),a.accessToken)){r=a.accessToken;let g=new URL(a.url);g.searchParams.set("topic","firehose"),g.searchParams.set("token",r),p=S(g.toString(),n)}},e.start(),e.onclose=()=>{let s=n.indexOf(e);s!==-1&&n.splice(s,1)},e.postMessage({type:"debug",payload:"Connected to shared worker"})};function c(t,e){t.forEach(s=>{s.postMessage(e)})}function S(t,e){let s=new EventSource(t);return c(e,{type:"debug",payload:"Connected and listening for Server Sent Events"}),s.onmessage=o=>{c(e,{type:"sse",payload:JSON.parse(o.data)})},s.onerror=o=>{console.error("SSE Error:",o),s.close()},s}function i(t,e){t.close(),c(e,{type:"debug",payload:"Stopped listening for Server Sent Events"})}
