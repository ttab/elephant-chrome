var o=[],c,g;self.onconnect=t=>{let e=t.ports[0];o.push(e),e.onmessage=s=>{let{type:n,payload:a}=s.data;if(n==="accessToken"&&g!==a){if(g===a)return;a&&r(o,{type:"debug",payload:"Received updated token"}),g&&c&&d(c,o),a&&(c=p(a,o))}},e.start(),e.onclose=()=>{let s=o.indexOf(e);s!==-1&&o.splice(s,1)},e.postMessage({type:"debug",payload:"Connected to shared worker"})};function r(t,e){t.forEach(s=>{s.postMessage(e)})}function p(t,e){let s=new EventSource(`https://repository.stage.tt.se/sse?topic=firehose&token=${t}`);return r(e,{type:"debug",payload:"Now listening for Server Sent Events"}),s.onmessage=n=>{r(e,{type:"sse",payload:JSON.parse(n.data)})},s.onerror=n=>{console.error("SSE Error:",n),s.close()},s}function d(t,e){t.close(),r(e,{type:"debug",payload:"Stopped listening for Server Sent Events"})}
