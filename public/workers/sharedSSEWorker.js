var i={version:17};var u="firehose",o=[],t,r;self.onconnect=n=>{let e=n.ports[0];o.push(e),e.onmessage=s=>{switch(s.data.type){case"connect":l(e,s.data);break;case"reload":p(s.data);break}},e.start(),e.postMessage({type:"connected",payload:i.version})};function l(n,e){let{payload:s}=e;s.accessToken!==r&&(a("Received SSE connect request with updated token"),r&&t&&d(),s.accessToken&&(r=s.accessToken,t=f(s.url,r))),t&&n.postMessage({type:"debug",payload:`SSE connected, ${o.length} clients listening for events`})}function p(n){t&&(a(`Shutting down sharedSSEWorker version ${i.version}`),d()),o.forEach(e=>{e.postMessage(n),e.close()}),o.length=0,self.close()}function f(n,e){let s=new URL(n);s.searchParams.set("topic",u),s.searchParams.set("token",e);let c=new EventSource(s);return c.onmessage=g=>{S({type:"sse",payload:JSON.parse(g.data)})},c.onerror=g=>{a("Error listening for server sent events"),d()},c}function d(){t&&(a("Shutting down listener for server sent events"),t.close(),t=void 0)}function S(n){o.forEach(e=>{e.postMessage(n)})}function a(n){S({type:"debug",payload:n})}
